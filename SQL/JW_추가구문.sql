DROP TABLE "WHERE_TO" CASCADE CONSTRAINTS;


DROP SEQUENCE SEQ_WHERE_TO_NO;
CREATE SEQUENCE SEQ_WHERE_TO_NO NOCYCLE;

CREATE TABLE "WHERE_TO" (
	"NO"	NUMBER		NOT NULL,
	"NEWS_NO"	NUMBER		NOT NULL,
	"NAME"	VARCHAR(50)		NOT NULL,
	"ADDRESS"	VARCHAR(400)		NOT NULL,
    "ADDR_DETAIL"	VARCHAR(400)
);

COMMENT ON COLUMN "WHERE_TO"."NO" IS '지역 번호';

COMMENT ON COLUMN "WHERE_TO"."NAME" IS '장소 이름';

COMMENT ON COLUMN "WHERE_TO"."ADDRESS" IS '주소';

COMMENT ON COLUMN "WHERE_TO"."ADDR_DETAIL" IS '상세주소';

ALTER TABLE "WHERE_TO" ADD CONSTRAINT "PK_WHERE_TO" PRIMARY KEY (
	"NO"
);

ALTER TABLE "WHERE_TO" ADD CONSTRAINT "FK_NEWS_TO_WHERE_TO_1" FOREIGN KEY (
	"NEWS_NO"
)
REFERENCES "NEWS" (
	"NO"
);



--INSERT INTO WHERE_TO VALUES(SEQ_WHERE_TO_NO.NEXTVAL, SEQ_NEWS_NO.CURRVAL, '장소이름', '서울시 강남구 역삼동');

INSERT INTO WHERE_TO VALUES(SEQ_WHERE_TO_NO.NEXTVAL, 111, '신사동', '서울시 강남구 신사동','502호');
INSERT INTO WHERE_TO VALUES(SEQ_WHERE_TO_NO.NEXTVAL, 112, '압구정동', '서울시 강남구 압구정동','502호');
INSERT INTO WHERE_TO VALUES(SEQ_WHERE_TO_NO.NEXTVAL, 113, '논현동', '서울시 강남구 논현동','502호');
INSERT INTO WHERE_TO VALUES(SEQ_WHERE_TO_NO.NEXTVAL, 114, '청담동', '서울시 강남구 청담동','502호');
INSERT INTO WHERE_TO VALUES(SEQ_WHERE_TO_NO.NEXTVAL, 115, '삼성동', '서울시 강남구 삼성동','502호');
INSERT INTO WHERE_TO VALUES(SEQ_WHERE_TO_NO.NEXTVAL, 116, '대치동', '서울시 강남구 대치동','502호');
INSERT INTO WHERE_TO VALUES(SEQ_WHERE_TO_NO.NEXTVAL, 117, '역삼동', '서울시 강남구 역삼동','502호');
INSERT INTO WHERE_TO VALUES(SEQ_WHERE_TO_NO.NEXTVAL, 118, '도곡동', '서울시 강남구 도곡동','502호');
INSERT INTO WHERE_TO VALUES(SEQ_WHERE_TO_NO.NEXTVAL, 119, '개포동', '서울시 강남구 개포동','502호');
INSERT INTO WHERE_TO VALUES(SEQ_WHERE_TO_NO.NEXTVAL, 120, '수서동', '서울시 강남구 수서동','502호');
COMMIT;

SELECT COUNT(*)
FROM MEMBER
WHERE ID='user01';

SELECT 
    W.NO
    ,NEWS_NO
    ,NAME
    ,ADDRESS
    ,ADDR_DETAIL
    ,DELETE_YN
FROM WHERE_TO W
JOIN NEWS N ON N.NO = W.NEWS_NO
WHERE DELETE_YN = 'N'
;

SELECT
    NO AS PLACE_NO
    ,NAME
    ,ADDRESS
    ,ADDR_DETAIL
FROM WHERE_TO
WHERE NEWS_NO = 111;


SELECT * FROM
    ( 
    SELECT
    ROWNUM 
    ,T.* FROM(
            SELECT
                M.NO
                , M.NICK
                , SUM(P.POINT)OVER(PARTITION BY P.MEMBER_NO) POINT
            FROM MEMBER M
            LEFT OUTER JOIN POINT_HISTORY P ON M.NO = P.MEMBER_NO 
            WHERE QUIT_YN = 'N'
            AND GRADE_NO != 8
            AND GRADE_NO != 9
            AND EXTRACT(MONTH FROM P.TIME_REPORT) = EXTRACT(MONTH FROM SYSDATE)
            AND EXTRACT(YEAR FROM P.TIME_REPORT) = EXTRACT(YEAR FROM SYSDATE)
            ORDER BY POINT DESC    
            ) T
    )   
WHERE ROWNUM BETWEEN 1 AND 10;
INSERT INTO POINT_PLACE VALUES(1,'카페');
COMMIT;
INSERT INTO POINT_HISTORY VALUES(SEQ_POINT_HISTORY_NO.NEXTVAL,1,SYSDATE,100,1);
INSERT INTO POINT_HISTORY VALUES(SEQ_POINT_HISTORY_NO.NEXTVAL,2,SYSDATE,200,1);
INSERT INTO POINT_HISTORY VALUES(SEQ_POINT_HISTORY_NO.NEXTVAL,3,SYSDATE,300,1);
INSERT INTO POINT_HISTORY VALUES(SEQ_POINT_HISTORY_NO.NEXTVAL,4,SYSDATE,400,1);
INSERT INTO POINT_HISTORY VALUES(SEQ_POINT_HISTORY_NO.NEXTVAL,5,SYSDATE,500,1);
INSERT INTO POINT_HISTORY VALUES(SEQ_POINT_HISTORY_NO.NEXTVAL,6,SYSDATE,600,1);
INSERT INTO POINT_HISTORY VALUES(SEQ_POINT_HISTORY_NO.NEXTVAL,55,SYSDATE,700,1);
INSERT INTO POINT_HISTORY VALUES(SEQ_POINT_HISTORY_NO.NEXTVAL,77,SYSDATE,800,1);
INSERT INTO POINT_HISTORY VALUES(SEQ_POINT_HISTORY_NO.NEXTVAL,555,SYSDATE,900,1);
INSERT INTO POINT_HISTORY VALUES(SEQ_POINT_HISTORY_NO.NEXTVAL,777,SYSDATE,1000,1);
COMMIT;



