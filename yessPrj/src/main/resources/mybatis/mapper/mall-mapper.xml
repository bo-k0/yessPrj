<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mallMapper">

	<!-- 상품목록조회 -->
	<select id="selectMallList" resultType="com.kh.yess.mall.vo.ProdVo">
		SELECT P.PROD_NO, P.PROD_CATE_NO, P.PROD_NAME, P.PROD_PRICE, A.PROD_IMG_NO, A.THUMB_YN, A.CHANGE_NAME
		FROM YESSMALL_PROD P
		JOIN YESSMALL_ATTACHMENT A
		ON P.PROD_NO = A.PROD_NO
		JOIN YESSMALL_CATEGORY C
		ON P.PROD_CATE_NO = C.PROD_CATE_NO
		WHERE A.THUMB_YN = 'Y'
		
		<if test=' category != null and category != "" '>
			AND P.PROD_CATE_NO = ${category}
		</if>
		AND P.PROD_NAME LIKE '%${search}%'
		ORDER BY PROD_NO DESC
	</select>  
	
	<!-- 상품상세조회 -->
	<select id="selectProdOne" resultType="ProdVo">
		SELECT * 
		FROM YESSMALL_PROD
		WHERE PROD_NO = #{prodNo}
	</select>
	<select id="selectProdImgList" resultType="AttachmentVo">
		SELECT *
		FROM YESSMALL_ATTACHMENT
		WHERE PROD_NO = #{prodNo}
	</select>
	
	
	
	
	<!-- 상품등록 -->
	<insert id="addProd">
	 	INSERT INTO YESSMALL_PROD VALUES(
	 	SEQ_YESSMALL_PROD_NO.NEXTVAL, 
	 	#{prodCateNo}, 
	 	#{prodName}, 
	 	#{prodInfo}, 
	 	#{prodDetail}, 
	 	#{prodPrice}, 
	 	#{prodStock}
	 	)
	</insert>
	
	<!-- 상품이미지등록 -->
	<insert id="addProdImgThumb">
		INSERT INTO YESSMALL_ATTACHMENT VALUES(
	 	SEQ_YESSMALL_ATTACHMENT_NO.NEXTVAL, 
	 	SEQ_YESSMALL_PROD_NO.CURRVAL,
	 	#{originName},
		#{changeName} ,
		#{filePath},
		SYSDATE,'Y',default)
	</insert>
	
	<insert id="addProdImg">
		INSERT INTO YESSMALL_ATTACHMENT VALUES(
	 	SEQ_YESSMALL_ATTACHMENT_NO.NEXTVAL, 
	 	SEQ_YESSMALL_PROD_NO.CURRVAL,
	 	#{originName},
		#{changeName} ,
		#{filePath},
		SYSDATE,default,default)

	</insert>
	
</mapper>